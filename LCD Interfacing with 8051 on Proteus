//LCD Interfacing with 8051 on Proteus
#include <reg51.h>  // Include register definition file for AT89C51

#define LCD P0       // LCD data port connected to Port 0

// LCD control pins connected to Port 1
sbit RS = P1^0;      // Register Select (0 = Command, 1 = Data)
sbit RW = P1^1;      // Read/Write (0 = Write, 1 = Read)
sbit E  = P1^2;      // Enable pin

// Function declarations
void Delay(unsigned int ms);
void LCD_Command(unsigned char cmd);
void LCD_Char(unsigned char Data);
void LCD_Init(void);
void LCD_String(char *str);

// ----------- MAIN FUNCTION -------------
void main() {
    LCD_Init();              // Initialize LCD
    LCD_String("ISQUAREIT"); // Display message on LCD
    while (1);               // Infinite loop
}

// ----------- LCD INITIALIZATION -------------
void LCD_Init(void) {
    Delay(20);             // Wait for >15 ms after power on
    LCD_Command(0x38);     // 8-bit mode, 2 lines, 5x7 matrix
    Delay(5);
    LCD_Command(0x0C);     // Display ON, Cursor OFF
    LCD_Command(0x06);     // Auto-increment cursor
    LCD_Command(0x01);     // Clear display
    Delay(2);
}

// ----------- SEND COMMAND TO LCD -------------
void LCD_Command(unsigned char cmd) {
    RS = 0;        // Command mode
    RW = 0;        // Write operation
    LCD = cmd;     // Send command to data port
    E = 1;         // Enable high
    Delay(1);
    E = 0;         // Enable low
    Delay(2);      // Small delay for LCD to execute
}

// ----------- SEND CHARACTER TO LCD -------------
void LCD_Char(unsigned char Data) {
    RS = 1;        // Data mode
    RW = 0;        // Write operation
    LCD = Data;    // Send character to LCD
    E = 1;         // Enable high
    Delay(1);
    E = 0;         // Enable low
    Delay(2);
}

// ----------- SEND STRING TO LCD -------------
void LCD_String(char *str) {
    while (*str) {             // Loop until string ends
        LCD_Char(*str++);      // Display each character
    }
}

// ----------- DELAY FUNCTION -------------
void Delay(unsigned int ms) {
    unsigned int i, j;
    for (i = 0; i < ms; i++) {
        for (j = 0; j < 1275; j++);  // Approx 1 ms delay (for 12 MHz crystal)
    }
}
